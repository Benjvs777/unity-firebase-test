<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Join Room</title>
  <style>
    body { font-family: Arial; text-align: center; margin-top: 50px; }
    input, button { font-size: 1.2em; padding: 10px; margin: 10px; }
  </style>
</head>
<body>
  <h1>Join a Room</h1>

  <input type="text" id="roomCodeInput" placeholder="Enter room code">
  <input type="text" id="usernameInput" placeholder="Enter your name">
  <button id="joinButton">Join Room</button>

  <p id="status">Status: -</p>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBasY2nEGgmKsy-BbEsulzPINz7qojM_kM",
      authDomain: "cath-lab-sim.firebaseapp.com",
      databaseURL: "https://cath-lab-sim-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "cath-lab-sim",
      storageBucket: "cath-lab-sim.firebasestorage.app",
      messagingSenderId: "626683715160",
      appId: "1:626683715160:web:ac69363c84f5a40195742d",
      measurementId: "G-8FKR5QNEYT"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const joinButton = document.getElementById("joinButton");
    const statusEl = document.getElementById("status");

    joinButton.addEventListener("click", async () => {
      const code = document.getElementById("roomCodeInput").value.trim().toUpperCase();
      const username = document.getElementById("usernameInput").value.trim();

      if (!code) return alert("Enter a room code");
      if (!username) return alert("Enter your name");

      const roomRef = ref(db, "rooms/" + code);

      try {
        const snapshot = await get(roomRef);
        if (snapshot.exists()) {
          statusEl.textContent = "Status: Room found!";
          // Save to localStorage
          localStorage.setItem("roomCode", code);
          localStorage.setItem("username", username);
          // Go to role selection
          window.location.href = "roles.html";
        } else {
          statusEl.textContent = "Status: Room not found";
        }
      } catch (error) {
        statusEl.textContent = "Status: Error fetching room";
        console.error(error);
      }
    });
  </script>
</body>
</html>

